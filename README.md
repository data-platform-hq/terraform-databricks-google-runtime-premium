# Google Databricks premium Runtime Terraform module
Terraform module for creation Google Databricks premium Runtime

## Usage

<!-- BEGIN_TF_DOCS -->
## Requirements
| Name                                                                         | Version   |
|------------------------------------------------------------------------------|-----------|
| <a name="requirement_terraform"></a> [terraform](#requirement\_terraform)    | >= 1.0.0  |
| <a name="requirement_databricks"></a> [databricks](#requirement\_databricks) | >= 1.19.0 |

## Providers
| Name                                                                   | Version |
|------------------------------------------------------------------------|---------|
| <a name="provider_databricks"></a> [databricks](#provider\_databricks) | 1.19.0  |

## Modules
No modules.

## Resources
| Name                                                                                                                                                       | Type     |
|------------------------------------------------------------------------------------------------------------------------------------------------------------|----------|
| [databricks_cluster.cluster](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/cluster#gcp_attributes)                   | resource |
| [databricks_cluster_policy.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/cluster_policy)                       | resource |
| [databricks_group.account_groups](https://registry.terraform.io/providers/databricks/databricks/latest/docs/data-sources/group)                            | data     |
| [databricks_group.admin](https://registry.terraform.io/providers/databricks/databricks/latest/docs/data-sources/group)                                     | data     |
| [databricks_group.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/group)                                         | resource |
| [databricks_user.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/user)                                           | resource |
| [databricks_service_principal.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/service_principal)                 | resource |
| [databricks_group_member.admin](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/group_member)                          | resource |
| [databricks_group_member.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/group_member)                           | resource |
| [databricks_entitlements.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/entitlements)                           | resource |
| [databricks_permissions.token_usage](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/permissions)                      | resource |
| [databricks_obo_token.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/obo_token)                                 | resource |
| [databricks_mount.gs](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/mount)                                           | resource |
| [databricks_permissions.clusters](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/permissions#cluster-usage)           | resource |
| [databricks_permissions.sql_endpoint](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/permissions#sql-warehouse-usage) | resource |
| [databricks_secret_scope.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/secret_scope)                           | resource |
| [databricks_secret.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/secret)                                       | resource |
| [databricks_secret_acl.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/secret_acl)                               | resource |
| [databricks_sql_endpoint.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/sql_endpoint)                           | resource |
| [databricks_sql_global_config.this](https://registry.terraform.io/providers/databricks/databricks/latest/docs/resources/sql_global_config)                 | resource |

## Inputs
| Name                                                                                                        | Description                                                                                                                                                                                                                                                                                                                                                                                                                                               | Type           | Default                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         | Required |
|-------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:--------:|
| <a name="input_suffix"></a> [suffix](#input\_suffix)                                                        | Resource name suffix                                                                                                                                                                                                                                                                                                                                                                                                                                      | `string`       | ""                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_workspace_admins"></a> [workspace\_admins](#input\_workspace\_admins)                        | Provide users or service principals to grant them Admin permissions in Workspace                                                                                                                                                                                                                                                                                                                                                                          | ` object`      | {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_iam_account_groups"></a> [iam\_account\_groups](#input\_iam\_account\_groups)                | List of objects with group name and entitlements for this group                                                                                                                                                                                                                                                                                                                                                                                           | `list(object)` | [{}]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |    no    |
| <a name="input_iam_workspace_groups"></a> [iam\_workspace\_groups](#input\_iam\_workspace\_groups)          | Used to create workspace group. Map of group name and its parameters, such as users and service principals added to the group. Also possible to configure group entitlements                                                                                                                                                                                                                                                                              | `map(object)`  | {}                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_token_lifetime_seconds"></a> [token\_lifetime\_seconds](#input\_token\_lifetime\_seconds)    | The lifetime of the token, in seconds. If no lifetime is specified, the token remains valid indefinitely                                                                                                                                                                                                                                                                                                                                                  | `number`       | `315569520`                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |    no    |
| <a name="input_secret_scope"></a> [secret\_scope](#input\_secret\_scope)                                    | Provides an ability to create custom Secret Scope, store secrets in it and assigning ACL for access management scope_name - name of Secret Scope to create;<br>acl - list of objects, where 'principal' custom group name, this group is created in 'Premium' module; 'permission' is one of "READ", "WRITE", "MANAGE";<br>secrets - list of objects, where object's 'key' param is created key name and 'string_value' is a value for it;                | `list(object)` | <pre>[{<br>  scope_name = null<br>  secrets = null<br>}]</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |    no    |
| <a name="input_custom_cluster_policies"></a> [custom\_cluster\_policies](#input\_custom\_cluster\_policies) | Provides an ability to create custom cluster policy, assign it to cluster and grant CAN_USE permissions on it to certain custom groups name - name of custom cluster policy to create can_use - list of string, where values are custom group names, there groups have to be created with Terraform; definition - JSON document expressed in Databricks Policy Definition Language. No need to call 'jsonencode()' function on it when providing a value; | `list(object)` | <pre>list(object({<br>  name       = string<br>  can_use    = list(string)<br>  definition = any<br>}))<br></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |    no    |
| <a name="input_clusters"></a> [clusters](#input\_clusters)                                                  | Set of objects with parameters to configure Databricks clusters and assign permissions to it for certain custom groups                                                                                                                                                                                                                                                                                                                                    | `set(object)`  | <pre>set(object({<br>    cluster_name                 = string<br>    runtime_engine               = optional(string)<br>    spark_version                = optional(string, "13.3.x-scala2.12")<br>    spark_conf                   = optional(map(any), {})<br>    spark_env_vars               = optional(map(any), {})<br>    data_security_mode           = optional(string, "USER_ISOLATION")<br>    node_type_id                 = optional(string, "")<br>    autotermination_minutes      = optional(number, 30)<br>    num_workers                  = optional(number)<br>    min_workers                  = optional(number, 1)<br>    max_workers                  = optional(number, 2)<br>    google_service_account       = optional(string, "")<br>    availability                 = optional(string, "PREEMPTIBLE_WITH_FALLBACK_GCP")<br>    boot_disk_size               = optional(number)<br>    local_ssd_count              = optional(number)<br>    zone_id                      = optional(string, "")<br>    cluster_log_conf_destination = optional(string, null)<br>    single_user_name             = optional(string, null)<br>    permissions = optional(set(object({<br>      group_name       = string<br>      permission_level = string<br>    })), [])<br>    pypi_library_repository = optional(set(string), [])<br>    maven_library_repository = optional(set(object({<br>      coordinates = string<br>      exclusions  = set(string)<br>   })), [])<br>}))<br></pre> |    no    |
| <a name="input_sql_endpoint"></a> [sql\_endpoint](#input\_sql\_endpoint)                                    | Set of objects with parameters to configure SQL Endpoint and assign permissions to it for certain custom groups                                                                                                                                                                                                                                                                                                                                           | `set(object)`  | <pre> set(object({ <br>   name                 = string <br>   cluster_size         = optional(string, "2X-Small") <br>   min_num_clusters     = optional(number, 0) <br>   max_num_clusters     = optional(number, 1) <br>   auto_stop_mins       = optional(string, "30") <br>   enable_photon        = optional(bool, false) <br>   spot_instance_policy = optional(string, "RELIABILITY_OPTIMIZED") <br>   warehouse_type       = optional(string, "PRO") <br>   permissions          =  optional(set(object({ <br>     group_name         = string <br>     permission_level   = string<br>}))<br></pre></pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |    no    |
| <a name="input_sql_global_config"></a> [sql\_global\_config](#input\_sql\_global\_config)                   | Parameters to configure the security policy, databricks_instance_profile, and data access properties for all databricks_sql_endpoint of workspace                                                                                                                                                                                                                                                                                                         | `object`       | <pre> object({ <br>   security_policy            = optional(string) <br>   data_access_config         = optional(map(any)) <br>   sql_google_service_account = optional(string) <br>   sql_config_params          = optional(map(any)) <br>}) <br>   default     = null</pre>                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |    no    |
| <a name="input_mount_enabled"></a> [mount\_enabled](#input\_mount\_enabled)                                 | Boolean flag that determines whether mount point for storage bucket is created                                                                                                                                                                                                                                                                                                                                                                            | `bool`         | false                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                           |    no    |
| <a name="input_mount_name"></a> [mount\_name](#input\_mount\_name)                                          | Full Google Storage mount name                                                                                                                                                                                                                                                                                                                                                                                                                            | `string`       | ""                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_mount_bucket_name"></a> [mount\_bucket\_name](#input\_mount\_bucket\_name)                   | Full Google Storage mounted bucket name                                                                                                                                                                                                                                                                                                                                                                                                                   | `string`       | ""                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_mount_service_account"></a> [mount\_service\_account](#input\_mount\_service\_account)       | Email of registered Google Service Account for mounted bucket data access                                                                                                                                                                                                                                                                                                                                                                                 | `string`       | ""                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |
| <a name="input_mount_cluster_name"></a> [mount\_cluster\_name](#input\_mount\_cluster\_name)                | Name of the cluster that will be used during storage mounting                                                                                                                                                                                                                                                                                                                                                                                             | `string`       | null                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              |    no    |

## Outputs
| Name                                                                                                                          | Description                                          |
|-------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------|
| <a name="output_token"></a> [token](#output\_token)                                                                           | Databricks Personal Authorization Token (sensitive)  |
| <a name="output_clusters"></a> [clusters](#output\_clusters)                                                                  | Provides name and unique identifier for the clusters |
| <a name="output_sql_endpoint_data_source_id"></a> [sql\_endpoint\_data\_source\_id](#output\_sql\_endpoint\_data\_source\_id) | ID of the data source for this endpoint              |
| <a name="output_sql_endpoint_jdbc_url"></a> [sql\_endpoint\_jdbc\_url](#output\_sql\_endpoint\_jdbc\_url)                     | JDBC connection string of SQL Endpoint               |

<!-- END_TF_DOCS -->

## License

Apache 2 Licensed. For more information please see [LICENSE](https://github.com/data-platform-hq/terraform-databricks-google-runtime-premium/blob/main/LICENSE)
